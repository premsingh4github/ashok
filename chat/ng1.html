<!DOCTYPE html>
<html>
<head>
	<title>learning ng broadcast</title>
	<title>PubSub Communication</title>
	<script src="angular.min.js" type="text/javascript"></script>
	<style>
	    div {
	        background-color: rgba(120,120,120,0.2);
	        padding: 10px;
	    }
	</style>
</head>
<body ng-app="app">
	<div ng-controller="controllerA">
	    <input data-ng-model="branchName" type="text" /><span ng-click="addBranch()">add</span>
	</div>
	<div ng-controller="controllerB">
	    <input data-ng-model="branchName" type="text" /><span ng-click="removeBranch()">remove</span>
	</div>
	<div ng-controller="controllerC">
	    <div ng-repeat="branch in branches" >
	      <span>{{branch.name}}</span>
	    </div>
	</div>
	<script type="text/javascript">
	var app = angular.module('app',[]);
	app.controller('controllerA',['$scope','pubsubService',controllerA]);
		function controllerA ($scope,pubsubService) {
			$scope.addBranch = function () {
       			pubsubService.addBranch($scope.branchName);
   			};
		}
	app.controller('controllerB',['$scope','pubsubService',controllerB]);
		function controllerB ($scope,pubsubService) {
			$scope.removeBranch = function(){
				pubsubService.removeBranch($scope.branchName);
			} 
		}
	app.controller('controllerC',['$scope','pubsubService',controllerC]);
		function controllerC ($scope,pubsubService) {
			$scope.branches = pubsubService.getBranches();
		}
	app.factory('pubsubService',['$rootScope',pubsubService]);
	function pubsubService($rootScope){
		var branches = [{"name":"ktm"},{"name":"lalitpur"},{"name":"suraj"}];
		function getBranches(){
			return branches;
		}
		var addBranch = function(branchName){
	        branches.push({"name":branchName});
	        $rootScope.$broadcast('addBranch',{
	            branches: branches
	        });
    	}
    	function removeBranch(branchName){
    		branches.forEach(function(el,i){
    			if(el.name == branchName){
    				branches.splice(i,1);
    			}
    			//console.log(el);
    		});
    	}
		return {
		    getBranches: getBranches,
		    addBranch : addBranch,
		    removeBranch: removeBranch,
		    
		};
	}
	</script>
	<script type="text/javascript">
	</script>

</body>
</html>